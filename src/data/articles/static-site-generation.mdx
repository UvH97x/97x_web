---
title: "Next.jsでのApp Routerを使用したStatic Site Generation (SSG)"
created_at: "2024-09-19"
updated_at: null
author: "ChatGPT"
tags: ["Next.js", "SSG", "MDX", "App Router"]
---

# Next.jsでのApp Routerを使用したStatic Site Generation (SSG)

この記事では、Next.jsのApp Routerを使用し、MDX形式の記事をビルド時に静的に生成する方法（SSG）について解説します。具体的には、`next-mdx-remote`を用いたMDXのシリアライズ、クライアントサイドとサーバーサイドの分離、そして記事をビルド時にSSGする方法について説明します。

---

## 前提条件

この操作を実行するには、以下の依存関係が必要です。

```bash
npm install next-mdx-remote
```

次に、必要なディレクトリ構造は以下のようになります。

```css
├── src
│   ├── app
│   │   ├── articles
│   │   │   ├── [page_title]
│   │   │   └── page.tsx
│   ├── components
│   │   └── MDXRemoteRenderer.tsx
│   ├── data
│   │   └── articles
│   │       └── sample.mdx
│   └── lib
│       ├── customParser.ts
│       └── serializeMdx.ts
```

---

# MDXのシリアライズ

最初に、next-mdx-remoteを使用してMDX形式の記事をシリアライズするためのserializeMdx関数を作成します。

```ts
// src/lib/serializeMdx.ts
import { serialize } from 'next-mdx-remote/serialize';
import remarkMath from 'remark-math';
import rehypeKatex from 'rehype-katex';

export async function serializeMdx(content: string) {
  return await serialize(content, {
    mdxOptions: {
      remarkPlugins: [remarkMath],
      rehypePlugins: [rehypeKatex],
    },
  });
}
```

---

# MDXのコンテンツをレンダリング

MDXのコンテンツをクライアントサイドでレンダリングするために、MDXRemoteをクライアントコンポーネントとして扱う必要があります。そのため、MDXRemoteRenderer.tsxを作成し、"use client"を追加します。

```tsx
// src/components/MDXRemoteRenderer.tsx
'use client';  // クライアントコンポーネントとして宣言

import { MDXRemote } from 'next-mdx-remote';
import { MDXRemoteSerializeResult } from 'next-mdx-remote';

interface MDXRemoteRendererProps {
  source: MDXRemoteSerializeResult;
}

const MDXRemoteRenderer: React.FC<MDXRemoteRendererProps> = ({ source }) => {
  return <MDXRemote {...source} />;
};

export default MDXRemoteRenderer;
```

---

